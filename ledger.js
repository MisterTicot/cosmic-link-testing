(window.webpackJsonp=window.webpackJsonp||[]).push([[4],{146:function(e,n){},20:function(e,n,t){"use strict";var r,c,a=t(138),o=t(140),u=n,s=t(77),i=t(141).timeout,p=t(142).default,l=s.isBrowser?t(152).default:s.nodeRequire("@ledgerhq/hw-transport-node-hid").default;function f(e){return h.apply(this,arguments)}function h(){return(h=o(a.mark((function e(n){var t,c,o,f;return a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:console.log("Attempting ledger connection..."),r=!0;case 2:if(!r||u.publicKey){e.next=42;break}if(t=+new Date,e.prev=4,u.transport&&!s.isNode){e.next=9;break}return e.next=8,l.create();case 8:u.transport=e.sent;case 9:return u.application&&!s.isNode||(u.application=new p(u.transport)),c=u.application,e.t0=Object,e.t1=u,e.next=15,c.getPublicKey(n.replace(/^m\//,""));case 15:return e.t2=e.sent,e.t0.assign.call(e.t0,e.t1,e.t2),e.t3=Object,e.t4=u,e.next=21,c.getAppConfiguration();case 21:e.t5=e.sent,e.t3.assign.call(e.t3,e.t4,e.t5),u.path=n,m(),e.next=40;break;case 27:if(e.prev=27,e.t6=e.catch(4),"U2FNotSupported"===e.t6.id&&("iframe[src^=chrome-extension/*/u2f-comms.html]",(o=document.querySelector("iframe[src^=chrome-extension/*/u2f-comms.html]"))&&o.parentNode.removeChild(o)),f=+new Date-t,!("U2F_1"===e.t6.id||"U2F_4"===e.t6.id&&f<25e3)){e.next=37;break}throw b(),e.t6.message="Connexion invite cancelled",e.t6;case 37:if(!(f<8e3)){e.next=40;break}return e.next=40,i(8e3-f);case 40:e.next=2;break;case 42:case"end":return e.stop()}}),e,null,[[4,27]])})))).apply(this,arguments)}function d(e){return x.apply(this,arguments)}function x(){return(x=o(a.mark((function e(n){return a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,n.close();case 3:e.next=8;break;case 5:e.prev=5,e.t0=e.catch(0),console.error(e.t0);case 8:case"end":return e.stop()}}),e,null,[[0,5]])})))).apply(this,arguments)}function b(){r=null,u.path=null,u.publicKey=null}function v(){r=null,w.forEach((function(e){return u[e]=null}))}u.publicKey=null,u.path=null,u.version=null,u.multiOpsEnabled=null,u.transport=null,u.application=null,u.connect=o(a.mark((function e(){var n,t,o=arguments;return a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=o.length>0&&void 0!==o[0]?o[0]:1,t=u.connect.path(n),!c){e.next=5;break}return e.next=5,c;case 5:return u.path&&u.path!==t&&b(),r||(r=f(t)),e.abrupt("return",r);case 8:case"end":return e.stop()}}),e)}))),u.connect.path=function(e){if("number"==typeof e){if(e<1)throw new Error("Account number starts at 1.");return"".concat("m/44'/148'","/").concat(e-1,"'")}return e},u.sign=function(){var e=o(a.mark((function e(n){var t,r;return a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(u.publicKey){e.next=2;break}throw new Error("No ledger wallet connected.");case 2:return e.next=4,u.application.signTransaction(u.path.replace(/^m\//,""),n.signatureBase());case 4:return t=e.sent,r=t.signature.toString("base64"),n.addSignature(u.publicKey,r),e.abrupt("return",n);case 8:case"end":return e.stop()}}),e)})));return function(n){return e.apply(this,arguments)}}(),u.disconnect=o(a.mark((function e(){var n;return a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=u.transport,v(),!n){e.next=9;break}return(c=d(n)).then(k),e.next=7,c;case 7:e.next=12;break;case 9:if(!c){e.next=12;break}return e.next=12,c;case 12:c=null;case 13:case"end":return e.stop()}}),e)})));var w=["transport","application","path","version","publicKey","multiOpsEnabled"];function m(){return g.apply(this,arguments)}function g(){return(g=o(a.mark((function e(){return a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:console.log("Ledger connected"),"function"==typeof u.onConnect&&u.onConnect();case 2:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function k(){console.log("Ledger disconnected"),"function"==typeof u.onDisconnect&&u.onDisconnect()}u.newAccount=o(a.mark((function e(){var n,t,r,c=arguments;return a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=c.length>0&&void 0!==c[0]?c[0]:"https://horizon.stellar.org",e.next=3,u.scan({horizon:n,attempts:1,includeMerged:!0});case 3:return t=e.sent,r=t[t.length-1],e.next=7,u.connect(r?r.account+1:1);case 7:case"end":return e.stop()}}),e)}))),u.scan=function(){var e=o(a.mark((function e(n){var r,c,o,s,i,p,l,f,h,d,x,b,v,w,m;return a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:r=n.horizon,c=void 0===r?"https://horizon.stellar.org":r,o=n.attempts,s=void 0===o?3:o,i=n.includeMerged,p=void 0!==i&&i,"string"==typeof c&&(l=t(158),f=l.Server,c=new f(c)),h=[],d=0,x=1;case 4:if(!(d<s)){e.next=16;break}return e.next=7,u.getPublicKeys(x,1);case 7:return b=e.sent[0],v=c.effects().forAccount(b.publicKey),e.next=11,v.order("desc").limit(1).call().catch((function(){return null}));case 11:(w=e.sent)?(d=0,m=w.records[0],b.state="account_removed"===m.type?"merged":"open",(p||"open"===b.state)&&h.push(b)):d++,x++,e.next=4;break;case 16:return e.abrupt("return",h);case 17:case"end":return e.stop()}}),e)})));return function(n){return e.apply(this,arguments)}}(),u.getPublicKeys=o(a.mark((function e(){var n,t,r,c,o=arguments;return a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n=o.length>0&&void 0!==o[0]?o[0]:1,t=o.length>1&&void 0!==o[1]?o[1]:1,r=[],c=n;case 4:if(!(c<n+t)){e.next=11;break}return e.next=7,u.connect(c);case 7:r.push({account:c,publicKey:u.publicKey,path:u.path});case 8:c++,e.next=4;break;case 11:return e.abrupt("return",r);case 12:case"end":return e.stop()}}),e)}))),u.onConnect=null,u.onDisconnect=null}}]);
//# sourceMappingURL=ledger.js.map