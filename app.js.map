{"version":3,"sources":["webpack:///./src/signing-ui.js","webpack:///./src/tamper.js","webpack:///./src/app.js","webpack:///./src/app-interface.js","webpack:///./src/helpers.js","webpack:///./src/app-widget.js"],"names":["main","exports","cosmicLib","require","CosmicLink","dom","env","html","QrCode","timeout","authenticators","the","enableButton","disableButton","readWriteBox","readOnlyBox","disableBox","display","showIf","init","key","query","rewrite","cosmiclink_description","nodes","forEach","entry","append","value","authenticator","name","redirect","redirectionCheckbox","checked","qrCode","qrCodeUI","enable","localStorage","substr","id","passphrase","resolve","networkPassphrase","config","setupNetwork","refresh","async","cosmicLink","tdesc","authenticatorUI","redirectionUI","transactionUI","needSource","accountId","needNetwork","customNetwork","horizon","network","source","saveTransaction","transaction","handle","then","error","status","getAccountId","accountMsgbox","accountUI","disable","networkUI","hide","accountDiv","undefined","show","accountIdBox","message","placeholder","console","networkDiv","customNetworkSetup","networkSelector","publicNetwork","scrollLeft","testNetwork","onscroll","customPassphrase","customHorizon","lock","disabled","selector","onchange","onExit","style","textOverflow","networkName","redirection","redirectionForm","textarea","textareaForm","qrForm","redirectionButton","xdrBox","loadingAnim","url","buttonText","location","href","click","contextIsWidget","onclick","clear","isEmbedded","target","open","window","parent","postMessage","replace","redirectionMsgbox","sendTransaction","response","history","replaceState","textContent","send","document","referrer","back","type","create","canvas","toCanvas","margin","scale","title","QR","qrButton","className","tamper","src","myHash","alphabet","hash","i","charAt","Math","floor","random","length","signingUI","signingPage","Page","copyContent","add","sign","onSelect","pathname","search","current","select","origin","websiteUrl","header","help","sep7Utils","isWebHandlerSupported","registerSep7Handler","registerWebHandler","split","helpers","button","box","readOnly","cursor","element","classname","messageNode","flag","switchPage","from","to","body","activeElement","prevNode","grab","destroy","copiedNode","parentNode","insertBefore","setTimeout","hidden","load","parseQuery","params","keyval","val","decodeURIComponent","join","csp","content","handler","byId","qrcode","log","Object","keys","css"],"mappings":"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","file":"app.js","sourcesContent":["\"use strict\"\nconst main = exports\n\nconst cosmicLib = require(\"cosmic-lib\")\nconst CosmicLink = cosmicLib.CosmicLink\nconst dom = require(\"@cosmic-plus/domutils/es5/dom\")\nconst env = require(\"@cosmic-plus/jsutils/es5/env\")\nconst html = require(\"@cosmic-plus/domutils/es5/html\")\nconst QrCode = require(\"qrcode\")\nconst { timeout } = require(\"@cosmic-plus/jsutils/es5/misc\")\n\nconst authenticators = require(\"./authenticators\")\nconst the = require(\"./shared\")\n\nconst {\n  enableButton,\n  disableButton,\n  readWriteBox,\n  readOnlyBox,\n  disableBox,\n  display,\n  showIf\n} = require(\"./helpers\")\n\n// Run once page is fully loaded\nmain.init = function () {\n  // Step 1: Transaction\n  if (!the.query) html.rewrite(dom.cosmiclink_description, \"No transaction\")\n\n  // Step 2: Authenticator\n  authenticators.nodes.forEach(entry => html.append(dom.authenticators, entry))\n  dom.authenticators.value = the.authenticator.name\n\n  // Step 3: Signing\n  if (the.redirect) dom.redirectionCheckbox.checked = true\n  if (the.qrCode) qrCodeUI.enable()\n\n  // CosmicLib network setup\n  for (let key in localStorage) {\n    if (key.substr(0, 8) === \"network:\") {\n      const id = key.substr(8)\n      const passphrase = cosmicLib.resolve.networkPassphrase(id)\n      cosmicLib.config.setupNetwork(id, localStorage[key], passphrase)\n    }\n  }\n}\n\nmain.refresh = async function () {\n  if (the.query) the.cosmicLink = new CosmicLink(the.query)\n  else the.cosmicLink = { tdesc: {} }\n  authenticatorUI.init()\n  redirectionUI.init()\n  if (the.cosmicLink.query) transactionUI.refresh()\n}\n\n/*******************************************************************************\n * Step 1: Transaction UI\n */\n\nconst transactionUI = {}\n\ntransactionUI.refresh = function () {\n  if (the.authenticator.needSource && !the.accountId) {\n    if (!the.authenticator.getAccountId) {\n      redirectionUI.error(\"Please set a source account\")\n    }\n    return\n  }\n  if (the.authenticator.needNetwork) {\n    if (dom.customNetwork.checked && (!the.horizon || !the.network)) {\n      redirectionUI.error(\"Please fill custom network fields\")\n      return\n    }\n  }\n\n  cosmicLib.config.source = the.accountId\n  cosmicLib.config.network = the.network\n\n  const saveTransaction = the.transaction = the.authenticator.handle(\n    the.cosmicLink\n  )\n\n  the.transaction\n    .then(function (value) {\n      if (the.transaction === saveTransaction) redirectionUI.refresh(value)\n    })\n    .catch(function () {\n      if (the.transaction === saveTransaction)\n        redirectionUI.error(the.cosmicLink.status)\n    })\n}\n\n/*******************************************************************************\n * Step 2: Authenticator UI\n */\n\nconst authenticatorUI = {}\n\nauthenticatorUI.init = function () {\n  display(dom.accountMsgbox, \"\")\n  the.authenticator = authenticators[dom.authenticators.value]\n  localStorage.authenticator = the.authenticator.name\n\n  if (the.authenticator.needSource) accountUI.init()\n  else accountUI.disable()\n  if (the.authenticator.needNetwork) networkUI.init()\n  else networkUI.disable()\n\n  if (the.authenticator.refresh) the.authenticator.refresh(main.refresh)\n}\n\n/**\n * AccountID box UI\n */\nconst accountUI = {}\n\naccountUI.disable = function () {\n  html.hide(dom.accountDiv)\n  the.accountId = undefined\n}\n\naccountUI.init = async function () {\n  html.show(dom.accountDiv)\n\n  if (!the.authenticator.getAccountId) {\n    if (the.cosmicLink.tdesc.source) {\n      if (the.cosmicLink.tdesc.source.error) {\n        disableBox(dom.accountIdBox, the.cosmicLink.tdesc.source.error.message)\n      } else {\n        the.accountId = true\n        readOnlyBox(dom.accountIdBox, the.cosmicLink.tdesc.source)\n      }\n    } else {\n      the.accountId = localStorage.accountId\n      readWriteBox(\n        dom.accountIdBox,\n        \"Your Account Address or ID\",\n        the.accountId\n      )\n    }\n  } else {\n    the.accountId = undefined\n    disableBox(dom.accountIdBox, \"Connecting...\")\n\n    const authenticator = the.authenticator\n    try {\n      const accountId = await the.authenticator.getAccountId()\n      if (the.authenticator !== authenticator) return\n      the.accountId = accountId\n      readOnlyBox(dom.accountIdBox, accountId)\n      transactionUI.refresh()\n    } catch (error) {\n      if (the.authenticator !== authenticator) return\n      dom.accountIdBox.placeholder = \"Error\"\n      display(dom.accountMsgbox, \"error\", error.message + \".\")\n      console.error(error)\n    }\n  }\n}\n\n/**\n * Network selection UI\n */\nconst networkUI = {}\n\nnetworkUI.disable = function () {\n  html.hide(dom.networkDiv)\n  the.network = \"public\"\n  the.horizon = undefined\n}\n\nnetworkUI.init = function () {\n  html.show(dom.networkDiv)\n  html.hide(dom.customNetworkSetup)\n  the.network = the.cosmicLink.tdesc.network || localStorage.networkSelector\n  the.horizon = undefined\n\n  switch (the.network) {\n  case undefined:\n  case \"public\":\n    dom.publicNetwork.checked = true\n    dom.networkSelector.scrollLeft = 0\n    break\n  case \"test\":\n    dom.testNetwork.checked = true\n    break\n  default:\n    if (dom.networkSelector.onscroll) dom.networkSelector.onscroll()\n    // Doesn't works when called synchronously.\n    timeout(1).then(() => dom.networkSelector.scrollLeft = 999)\n    dom.customNetwork.checked = true\n\n    html.show(dom.customNetworkSetup)\n    if (!the.network) the.network = localStorage.customPassphrase\n    the.horizon =\n        cosmicLib.resolve.horizon(the.network || \"\")\n        || the.cosmicLink.tdesc.horizon\n    dom.customPassphrase.value = the.network || \"\"\n    dom.customHorizon.value = the.horizon || \"\"\n  }\n\n  if (the.cosmicLink.tdesc.network) networkUI.lock()\n}\n\nnetworkUI.lock = function () {\n  readOnlyBox(dom.customPassphrase)\n  dom.publicNetwork.disabled = true\n  dom.testNetwork.disabled = true\n  dom.customNetwork.disabled = true\n}\n\nnetworkUI.switch = function (selector) {\n  localStorage.networkSelector = selector\n  main.refresh()\n}\n\n/**\n * HTML Elements Events\n */\n\ndom.authenticators.onchange = function () {\n  if (the.authenticator && the.authenticator.onExit) the.authenticator.onExit()\n  the.redirect = localStorage.redirect = false\n  dom.redirectionCheckbox.checked = false\n  main.refresh()\n}\n\ndom.accountIdBox.onchange = function () {\n  the.accountId = localStorage.accountId = dom.accountIdBox.value\n  main.refresh()\n}\n\ndom.networkSelector.onscroll = function () {\n  dom.networkSelector.style.textOverflow = \"initial\"\n  dom.networkSelector.onscroll = undefined\n}\n\ndom.publicNetwork.onchange = () => networkUI.switch(\"public\")\ndom.testNetwork.onchange = () => networkUI.switch(\"test\")\ndom.customNetwork.onchange = () => networkUI.switch(\"\")\n\ndom.customPassphrase.onchange = function () {\n  const networkName = cosmicLib.resolve.networkName(dom.customPassphrase.value)\n  localStorage.customPassphrase = networkName\n  networkUI.switch(\"\")\n}\n\ndom.customHorizon.onchange = function () {\n  the.horizon = dom.customHorizon.value\n  if (the.horizon && the.horizon.substr(0, 4) !== \"http\") {\n    the.horizon = \"https://\" + the.horizon\n  }\n  if (the.network && the.horizon) {\n    const passphrase = cosmicLib.resolve.networkPassphrase(the.network)\n    cosmicLib.config.setupNetwork(the.network, the.horizon, passphrase)\n    localStorage[\"network:\" + passphrase] = the.horizon\n  }\n  if (the.network) main.refresh()\n}\n\n/*******************************************************************************\n * Step 3: Signing/Redirection UI\n */\n\nconst redirectionUI = {}\n\nredirectionUI.init = function () {\n  redirectionUI.display(\"\")\n  showIf(the.authenticator.redirection, dom.redirectionForm)\n  showIf(the.authenticator.textarea, dom.textareaForm)\n  showIf(the.query && the.authenticator.qrCode, dom.qrForm)\n\n  if (!the.query) {\n    if (the.authenticator.url) {\n      const onclick = () => location.href = the.authenticator.url\n      enableButton(dom.redirectionButton, the.authenticator.buttonText, onclick)\n    } else {\n      redirectionUI.error(\"No transaction\")\n    }\n  } else {\n    if (the.authenticator.redirection) disableButton(dom.redirectionButton, \"…\")\n    if (the.authenticator.textarea) disableBox(dom.xdrBox, \"Computing...\")\n    if (the.authenticator.qrCode) qrCodeUI.loadingAnim()\n  }\n}\n\nredirectionUI.refresh = function (value) {\n  if (the.authenticator.redirection) {\n    const onclick = () => redirectionUI.click(value)\n    enableButton(dom.redirectionButton, the.authenticator.buttonText, onclick)\n  }\n\n  if (the.redirect && !the.contextIsWidget) {\n    dom.redirectionButton.onclick()\n  }\n\n  if (the.authenticator.textarea) readOnlyBox(dom.xdrBox, value)\n  if (the.authenticator.qrCode) qrCodeUI.refresh(value)\n}\n\nredirectionUI.error = function (error) {\n  disableButton(dom.redirectionButton, error)\n  disableBox(dom.xdrBox, error)\n  html.clear(dom.qrCode)\n}\n\nredirectionUI.click = async function (value) {\n  if (typeof value === \"string\") {\n    if (\n      the.contextIsWidget\n      || env.isEmbedded && the.authenticator.target === \"new\"\n    ) {\n      open(value, \"_blank\")\n      window.parent.postMessage(\"close\", \"*\")\n    } else if (env.isEmbedded && the.authenticator.target === \"external\") {\n      open(value)\n      window.parent.postMessage(\"close\", \"*\")\n    } else {\n      location.replace(value)\n    }\n  } else if (typeof value === \"function\") {\n    display(dom.redirectionMsgbox, \"info\", \"Waiting for confirmation...\")\n    dom.redirectionButton.disabled = true\n\n    try {\n      const transaction = await value()\n      await redirectionUI.sendTransaction(transaction)\n    } catch (error) {\n      console.error(error.response || error)\n      redirectionUI.display(\"error\", error.message.replace(/\\.$/, \"\"))\n      dom.redirectionButton.disabled = false\n    }\n  }\n}\n\nredirectionUI.sendTransaction = async function () {\n  redirectionUI.display(\"info\", \"Sending to the network...\")\n  history.replaceState({}, \"\", the.cosmicLink.query)\n  dom.query.textContent = the.cosmicLink.query\n  networkUI.lock()\n\n  await the.cosmicLink.send()\n  redirectionUI.display(\"info\", \"Transaction validated\")\n  if (env.isEmbedded) parent.postMessage(\"close\", \"*\")\n  if (document.referrer) {\n    enableButton(dom.redirectionButton, \"Close\", () => history.back())\n  } else {\n    dom.redirectionButton.value = \"Done\"\n  }\n}\n\nredirectionUI.display = function (type, message) {\n  display(dom.redirectionMsgbox, type, message)\n}\n\nconst qrCodeUI = {}\n\nqrCodeUI.loadingAnim = function () {\n  html.rewrite(dom.qrCode, html.create(\"canvas\", \".cosmiclib_loadingAnim\"))\n}\n\nqrCodeUI.refresh = function (value) {\n  if (!the.authenticator.qrCode || !value) return\n\n  const canvas = html.create(\"canvas\")\n  QrCode.toCanvas(canvas, value, { margin: 0, scale: 4 })\n  canvas.title = value\n  html.rewrite(dom.qrCode, canvas)\n}\n\nqrCodeUI.switch = function () {\n  the.qrCode = localStorage.QR = !the.qrCode\n  if (the.qrCode) qrCodeUI.enable()\n  else qrCodeUI.disable()\n}\n\nqrCodeUI.enable = function () {\n  dom.qrButton.className = \"enabled\"\n  html.show(dom.qrCode)\n}\n\nqrCodeUI.disable = function () {\n  dom.qrButton.className = undefined\n  html.hide(dom.qrCode)\n}\n\n/**\n * HTML Elements Events\n */\n\ndom.redirectionButton.onclick = redirectionUI.click\ndom.qrButton.onclick = qrCodeUI.switch\n\ndom.redirectionCheckbox.onchange = function () {\n  the.redirect = localStorage.redirect = !the.redirect\n}\n","\"use strict\"\n/**\n * Robot tamper.\n */\nconst dom = require(\"@cosmic-plus/domutils/es5/dom\")\n\nfunction myHash () {\n  if (localStorage.myHash) return localStorage.myHash\n\n  var alphabet =\n    \"0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ\"\n  var size = 32\n\n  var hash = \"\"\n  for (var i = 0; i < size; i++) {\n    hash += alphabet.charAt(Math.floor(Math.random() * alphabet.length))\n  }\n\n  localStorage.myHash = hash\n  return hash\n}\n\ndom.tamper.src = \"https://robohash.org/\" + myHash()\n","\"use strict\"\n/**\n * Cosmic.Link Graphical User Interface\n */\nconst the = require(\"./shared\")\n\nif (the.contextIsWidget) {\n  require(\"./app-widget\")\n} else {\n  require(\"./app-interface\")\n}\n","\"use strict\"\n/**\n * App interface initialization.\n */\nconst cosmicLib = require(\"cosmic-lib\")\nconst dom = require(\"@cosmic-plus/domutils/es5/dom\")\nconst html = require(\"@cosmic-plus/domutils/es5/html\")\nconst Page = require(\"@cosmic-plus/domutils/es5/page\")\n\nconst the = require(\"./shared\")\nconst { copyContent } = require(\"./helpers\")\n\n/* Functions */\n\nfunction initInterface () {\n  // Signing interface\n  const signingUI = require(\"./signing-ui\")\n  const signingPage = Page.add(\"Sign\", dom.sign)\n  signingPage.onSelect = function () {\n    history.replaceState(\"\", null, location.pathname + location.search)\n    signingUI.refresh()\n  }\n  signingUI.init()\n\n  // Default page\n  if (Page.current === signingPage) signingPage.onSelect()\n  else if (!Page.current) Page.select(\"#sign\")\n\n  // Non-widget components\n  if (!the.contextIsWidget) {\n    initNonWidgetInterface()\n  }\n}\n\nfunction initNonWidgetInterface () {\n  // Header\n  if (location.origin === \"null\") {\n    dom.websiteUrl.textContent = location.pathname\n  } else {\n    dom.websiteUrl.textContent = location.origin + location.pathname\n  }\n  dom.query.textContent = location.search\n  dom.header.onclick = () => copyContent(dom.header)\n\n  // About page\n  Page.add(\"Help\", dom.help)\n\n  // SEP-0007\n  if (cosmicLib.sep7Utils.isWebHandlerSupported()) {\n    dom.registerSep7Handler.onclick = () => {\n      cosmicLib.sep7Utils.registerWebHandler(\n        location.href.split(/[?#]/, 1)[0],\n        \"Cosmic.link\"\n      )\n    }\n  } else {\n    // (hack) Keep the collapsed bottom margin.\n    dom.registerSep7Handler.textContent = \"\"\n  }\n  html.show(dom.registerSep7Handler)\n\n  // Robot tamper\n  require(\"./tamper\")\n}\n\n/* Init */\ninitInterface()\n","\"use strict\"\n/**\n * Generic helpers\n */\nconst helpers = exports\n\nconst dom = require(\"@cosmic-plus/domutils/es5/dom\")\nconst html = require(\"@cosmic-plus/domutils/es5/html\")\n\n/*******************************************************************************\n * Form Elements Helpers\n */\n\nhelpers.enableButton = function (button, value, onclick) {\n  if (typeof value === \"string\") button.value = value\n  button.onclick = onclick\n  button.disabled = false\n}\n\nhelpers.disableButton = function (button, value) {\n  if (typeof value === \"string\") button.value = value\n  button.disabled = true\n}\n\nhelpers.readWriteBox = function (box, placeholder, value) {\n  if (typeof value === \"string\") box.value = value\n  if (typeof placeholder === \"string\") box.placeholder = placeholder\n  box.disabled = false\n  box.readOnly = false\n  box.onclick = undefined\n  box.style.cursor = \"initial\"\n}\n\nhelpers.readOnlyBox = function (box, value) {\n  if (typeof value === \"string\") box.value = value\n  box.disabled = false\n  box.readOnly = true\n  box.onclick = () => helpers.copyContent(box)\n  box.style.cursor = \"pointer\"\n}\n\nhelpers.disableBox = function (box, placeholder) {\n  helpers.readWriteBox(box, placeholder, \"\")\n  box.disabled = true\n}\n\n/*******************************************************************************\n * Other Helpers\n */\n\nhelpers.display = function (element, type = \"\", message = \"\") {\n  const classname = type ? \".\" + type : null\n  const messageNode = classname\n    ? html.create(\"span\", classname, message)\n    : message\n  html.rewrite(element, html.create(\"span\", classname, messageNode))\n}\n\nhelpers.showIf = function (flag, element) {\n  flag ? html.show(element) : html.hide(element)\n}\n\nhelpers.switchPage = function (from, to) {\n  html.append(dom.body, from)\n  html.append(dom.main, to)\n}\n\nhelpers.copyContent = function (element) {\n  if (html.copyContent(element) && document.activeElement.value) {\n    const prevNode = html.grab(\"#copied\")\n    if (prevNode) html.destroy(prevNode)\n    const copiedNode = html.create(\"span\", \"#copied\", \"Copied\")\n    element.parentNode.insertBefore(copiedNode, element)\n    setTimeout(() => {\n      copiedNode.hidden = true\n    }, 3000)\n  }\n}\n","\"use strict\"\n/**\n * Widget interface initialization.\n */\nconst html = require(\"@cosmic-plus/domutils/es5/html\")\nconst load = require(\"@cosmic-plus/domutils/es5/load\")\n\nconst authenticators = require(\"./authenticators\")\nconst the = require(\"./shared\")\n\n/* Functions */\n\nasync function initWidget () {\n  const referrer = document.referrer.split(\"/\", 3).join(\"/\")\n  const hash = location.hash\n  const params = parseQuery(hash)\n\n  // Strengthen Content-Security-Policy.\n  const csp = html.grab(\"meta[http-equiv='Content-Security-Policy']\")\n  csp.content = csp.content.replace(\n    \"style-src *  ;\",\n    `\n    style-src 'self'\n      'sha256-UpnKee22eAiBMULu1lvaV7de7xOzTjdN7K/WZDBil10='\n      ${referrer};\n  `\n  )\n\n  // Interface control.\n  if (params.handler) {\n    const handler = authenticators.byId[params.handler]\n    if (handler) {\n      the.authenticator = handler\n    } else {\n      console.error(`Unknown handler: ${params.handler}`)\n    }\n  }\n  if (params.qrcode) {\n    the.qrCode = params.qrcode !== \"false\"\n  }\n  // eslint-disable-next-line no-console\n  console.log(\"Valid handlers: \", Object.keys(authenticators.byId))\n\n  // Style control.\n  if (params.css) {\n    await load.css(`${referrer}/${params.css}`).catch(console.error)\n  } else {\n    await load.css(\"widget.css\").catch(console.error)\n    if (params[\"css+\"]) {\n      await load.css(`${referrer}/${params[\"css+\"]}`).catch(console.error)\n    }\n  }\n  html.show(document.body)\n\n  // Interface initialization.\n  require(\"./app-interface\")\n\n  // Consistent reload (app-interface mess with location.hash)\n  location.hash = hash\n}\n\n/* Helpers */\nfunction parseQuery (query) {\n  const params = {}\n\n  query\n    .substr(1)\n    .split(\"&\")\n    .forEach(keyval => {\n      const key = keyval.split(\"=\", 1)[0]\n      const val = keyval.substr(key.length + 1)\n      params[key] = decodeURIComponent(val)\n    })\n\n  return params\n}\n\n/* Initialization */\ninitWidget()\n"],"sourceRoot":""}