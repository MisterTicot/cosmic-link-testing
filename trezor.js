(window.webpackJsonp=window.webpackJsonp||[]).push([[3],{198:function(e,n,t){"use strict";var r=t(57),o=t(31),a=t(75),i=t(55),s=t(56),c=t(76),u=t(48),p=function(e){function n(e){var t;return o(this,n),delete(t=a(this,i(n).call(this,l,e))).network,t.fee?t.fee=Number(t.fee)/1e7:t.fee=100*t.operations.length,(t.minTime||t.maxTime)&&(t.timebounds={minTime:t.minTime||null,maxTime:t.maxTime||null},delete t.minTime,delete t.maxTime),t.operations.forEach((function(e){"allowTrust"===e.type?(e.assetType=e.assetCode.length<=4?1:2,e.authorize=e.authorize?1:0):"changeTrust"===e.type?(f("operation changeTrust"),e.limit||(e.limit=l.amount("922337203685.4775807"))):"createPassiveSellOffer"===e.type?e.type="createPassiveOffer":"manageSellOffer"===e.type?e.type="manageOffer":"manageBuyOffer"===e.type?f("operation manageBuyOffer"):"setOptions"===e.type&&(f("set signer"),e.signer&&(e.signer_type=e.signer.type,e.signer_key=e.signer.key,e.signer_weight=e.signer.weight,delete e.signer))})),console.log("Trezor TX",JSON.stringify(s(t),null,2)),t}return c(n,e),n}(t(199)),l={};function f(e){throw new Error("This feature is not supported yet: ".concat(e,"."))}l.amount=function(e){return Number(1e7*e).toFixed(0)},l.asset=function(e){return"XLM"!==e.code||e.issuer?(e.type=e.code.length<=4?1:2,e):null},l.assetsArray=function(e){return e.map(l.asset)},l.buffer=function(e){return e.value?"base64"===e.type?u.from(e.value,"base64").toString("hex"):u.from(e.value).toString("hex"):""},l.date=function(e){return Number(new Date(e))/1e3},l.memo=function(e){return"text"===e.type?(e.type=1,e.text=e.value):"base64"===e.type?f("binary memo text"):"id"===e.type?(e.type=2,e.id=e.value):"hash"===e.type?(e.type=3,e.hash=e.value):"return"===e.type&&(e.type=4,e.hash=e.value),delete e.value,e},l.price=function(e){return"object"!==r(e)?{n:Number(e),d:1}:e},l.sequence=function(e){return Number(e)},l.signer=function(e){return e.key=e.value,"key"===e.type?e.type=0:"hash"===e.type?e.type=1:"tx"===e.type&&(e.type=2),e},e.exports=p},199:function(e,n,t){"use strict";var r=t(31),o=t(106),a=o.CosmicLink,i=o.specs,s={field:function(e,n,t){var r=i.fieldType[n];return e[r]?e[r](t):t},odesc:function(e,n){var t={};for(var r in n)t[r]=s.field(e,r,n[r]);return t}};e.exports=function e(n,t){var o=this;r(this,e);var c=t._networkPassphrase,u=new a(t,{network:c}).tdesc;i.transactionOptionalFields.forEach((function(e){var t=u[e];t&&(o[e]=s.field(n,e,t))})),this.operations=u.operations.map((function(e){return s.odesc(n,e)}))}},21:function(e,n,t){var r,o,a=t(22),i=t(23),s=n,c=t(48),u=t(26),p=t(99).default,l=(t(99).UI,t(198));function f(e,n,t){var r="m/44'/148'/".concat(e,"'");return(n||t)&&(r+=t?"/1'":"/0'"),n&&(r+="/".concat(n,"'")),r}function y(){return d.apply(this,arguments)}function d(){return(d=i(a.mark((function e(){var n;return a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return console.log("Attempting Trezor connection..."),s.error=void 0,r=p.stellarGetAddress({path:s.path}),e.next=5,r;case 5:if(n=e.sent,console.log(n),!n.success){e.next=13;break}s.publicKey=n.payload.address,s.keypair=u.Keypair.fromPublicKey(s.publicKey),h(),e.next=15;break;case 13:throw s.error=n.payload.error,new Error(s.error);case 15:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function h(){return m.apply(this,arguments)}function m(){return(m=i(a.mark((function e(){return a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:console.log("Trezor connected"),"function"==typeof s.onConnect&&ledger.onConnect();case 2:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function g(){console.log("Trezor disconnected"),v(),"function"==typeof s.onDisconnect&&s.onDisconnect()}function v(){r=null;["path","account","index","internalFlag","publicKey","keypair"].forEach((function(e){delete s[e]}))}s.register=function(e,n){p.manifest({email:n,appUrl:e})},s.connect=function(){var e=i(a.mark((function e(n,t,i){var c;return a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(void 0===n&&(n=s.account||0,t=s.index||0,i=s.internalFlag||!1),c=f(n,t,i),!o){e.next=6;break}return e.next=5,o;case 5:o=null;case 6:return s.path!==c&&(v(),s.path=c,s.account=n||0,s.index=t||0,s.internalFlag=i||!1),r||(r=y()),e.abrupt("return",r);case 9:case"end":return e.stop()}}),e)})));return function(n,t,r){return e.apply(this,arguments)}}(),p.on("DEVICE_EVENT",(function(e){console.log("DEVICE_EVENT",console.log(e)),"device-disconnect"===e.type?g():"device-connect"===e.type&&h()})),s.onConnect=null,s.onDisconnect=null,s.disconnect=i(a.mark((function e(){return a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:g();case 1:case"end":return e.stop()}}),e)})));var w=t(106).CosmicLink;s.sign=function(){var e=i(a.mark((function e(n){var t,r,o,i;return a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(s.publicKey){e.next=2;break}throw new Error("No Trezor connected.");case 2:return console.log("Input TX",JSON.stringify(new w(n).tdesc),null,2),e.next=5,p.stellarSignTransaction({path:s.path,networkPassphrase:n.networkPassphrase,transaction:new l(n)});case 5:if((t=e.sent).success){e.next=8;break}throw new Error(t.payload.error);case 8:return console.log(t.transaction),r=s.keypair.signatureHint(),o=c.from(t.payload.signature,"hex"),i=new u.xdr.DecoratedSignature({hint:r,signature:o}),n.signatures.push(i),console.log("signed",n),e.abrupt("return",n);case 15:case"end":return e.stop()}}),e)})));return function(n){return e.apply(this,arguments)}}()}}]);
//# sourceMappingURL=trezor.js.map