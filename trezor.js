(window.webpackJsonp=window.webpackJsonp||[]).push([[3],{198:function(e,t,n){"use strict";var r=n(59),o=n(33),a=n(76),i=n(58),s=n(57),c=n(77),u=n(49),l=n(26),p=function(e){function t(e){var n;return o(this,t),delete(n=a(this,i(t).call(this,f,e))).network,n.fee?n.fee=Number(n.fee)/1e7:n.fee=100*n.operations.length,(n.minTime||n.maxTime)&&(n.timebounds={minTime:null==n.minTime?null:n.minTime,maxTime:null==n.maxTime?null:n.maxTime},delete n.minTime,delete n.maxTime),n.operations.forEach((function(e){if("allowTrust"===e.type)e.assetType=e.assetCode.length<=4?1:2,e.authorize=e.authorize?1:0;else if("changeTrust"===e.type)e.limit||(e.limit="9223372036854775807"),e.line=e.asset,delete e.asset;else if("createPassiveSellOffer"===e.type)e.type="createPassiveOffer";else if("manageSellOffer"===e.type)e.type="manageOffer";else if("manageBuyOffer"===e.type);else if("setOptions"===e.type&&e.signer&&0===e.signer.type){var t=l.Keypair.fromPublicKey(e.signer.key);e.signer.key=t.rawPublicKey().toString("hex")}})),console.log("Trezor TX",JSON.stringify(s(n),null,2)),n}return c(t,e),t}(n(199)),f={};f.amount=function(e){return Number(1e7*e).toFixed(0)},f.asset=function(e){return"XLM"!==e.code||e.issuer?(e.type=e.code.length<=4?1:2,e):null},f.assetsArray=function(e){return e.map(f.asset)},f.buffer=function(e){return e.value?"base64"===e.type?u.from(e.value,"base64").toString("hex"):u.from(e.value).toString("hex"):""},f.date=function(e){return Number(new Date(e))/1e3},f.memo=function(e){return"text"===e.type?(e.type=1,e.text=e.value):"base64"===e.type?(e.type=1,e.text=u.from(e.value,"base64").toString("utf8"),e.text.match("\0")):"id"===e.type?(e.type=2,e.id=e.value):"hash"===e.type?(e.type=3,e.hash=e.value):"return"===e.type&&(e.type=4,e.hash=e.value),delete e.value,e},f.price=function(e){return"object"!==r(e)?{n:Number(e),d:1}:e},f.sequence=function(e){return Number(e)},f.signer=function(e){return e.key=e.value,delete e.value,"key"===e.type?e.type=0:"tx"===e.type?e.type=1:"hash"===e.type&&(e.type=2),e},e.exports=p},199:function(e,t,n){"use strict";var r=n(33),o=n(200),a=o.CosmicLink,i=o.specs,s={field:function(e,t,n){var r=i.fieldType[t];return e[r]?e[r](n):n},odesc:function(e,t){var n={};for(var r in t)n[r]=s.field(e,r,t[r]);return n}};e.exports=function e(t,n){var o=this;r(this,e);var c=new a(n).tdesc;i.transactionOptionalFields.forEach((function(e){var n=c[e];n&&(o[e]=s.field(t,e,n))})),this.operations=c.operations.map((function(e){return s.odesc(t,e)}))}},21:function(e,t,n){"use strict";var r,o=n(22),a=n(23),i=t,s=n(170).default,c=n(49),u=n(198);function l(){return p.apply(this,arguments)}function p(){return(p=a(o.mark((function e(){var t;return o.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return console.log("Attempting Trezor connection..."),r=s.stellarGetAddress({path:i.path,showOnTrezor:!1}),e.next=4,r;case 4:if(!(t=e.sent).success){e.next=10;break}i.publicKey=t.payload.address,y(),e.next=11;break;case 10:throw new Error(t.payload.error);case 11:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function f(){r=null;["path","publicKey"].forEach((function(e){return i[e]=null}))}function y(){console.log("Trezor connected"),"function"==typeof i.onConnect&&i.onConnect()}function h(){console.log("Trezor disconnected"),f(),"function"==typeof i.onDisconnect&&i.onDisconnect()}i.publicKey=null,i.path=null,i.register=function(e,t){s.manifest({email:t,appUrl:e})},i.connect=a(o.mark((function e(){var t,n,a=arguments;return o.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=a.length>0&&void 0!==a[0]?a[0]:i.path,n=t||"".concat("m/44'/148'","/0'"),"number"!=typeof t){e.next=6;break}if(!(t<1)){e.next=5;break}throw new Error("Account number starts at 1.");case 5:n="".concat("m/44'/148'","/").concat(t-1,"'");case 6:return i.path!==n&&(f(),i.path=n),r||(r=l()),e.abrupt("return",r);case 9:case"end":return e.stop()}}),e)}))),i.sign=function(){var e=a(o.mark((function e(t){var r,a,l,p,f,y;return o.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=n(26),i.publicKey){e.next=3;break}throw new Error("No Trezor connected.");case 3:return e.next=5,s.stellarSignTransaction({path:i.path,networkPassphrase:t.networkPassphrase,transaction:new u(t)});case 5:if((a=e.sent).success){e.next=8;break}throw new Error(a.payload.error);case 8:l=r.Keypair.fromPublicKey(i.publicKey),p=l.signatureHint(),f=c.from(a.payload.signature,"hex"),y=new r.xdr.DecoratedSignature({hint:p,signature:f}),t.signatures.push(y),console.log("signed",t);case 14:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),i.disconnect=function(){try{s.cancel()}catch(e){}h()},s.on("DEVICE_EVENT",(function(e){console.log("DEVICE_EVENT",console.log(e)),"device-disconnect"===e.type?h():"device-connect"===e.type&&y()})),i.onConnect=null,i.onDisconnect=null}}]);
//# sourceMappingURL=trezor.js.map