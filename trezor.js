(window.webpackJsonp=window.webpackJsonp||[]).push([[3],{196:function(e,n,t){"use strict";var r=t(56),o=t(32),a=t(74),i=t(54),c=t(55),s=t(75),u=t(47),p=function(e){function n(e){var t;return o(this,n),delete(t=a(this,i(n).call(this,l,e))).network,t.fee?t.fee=Number(t.fee)/1e7:t.fee=100*t.operations.length,(t.minTime||t.maxTime)&&(t.timebounds={minTime:t.minTime||null,maxTime:t.maxTime||null},delete t.minTime,delete t.maxTime),t.operations.forEach((function(e){"allowTrust"===e.type?(e.assetType=e.assetCode.length<=4?1:2,e.authorize=e.authorize?1:0):"changeTrust"===e.type?e.limit||(e.limit=l.amount("922337203685.4775807")):"createPassiveSellOffer"===e.type?e.type="createPassiveOffer":"manageSellOffer"===e.type?e.type="manageOffer":"manageBuyOffer"===e.type||"setOptions"===e.type&&e.signer&&(e.signer_type=e.signer.type,e.signer_key=e.signer.key,e.signer_weight=e.signer.weight,delete e.signer)})),console.log("XDR",e.toXDR()),console.log("Trezor TX",JSON.stringify(c(t),null,2)),t}return s(n,e),n}(t(197)),l={};l.amount=function(e){return Number(1e7*e).toFixed(0)},l.asset=function(e){return"XLM"!==e.code||e.issuer?(e.type=e.code.length<=4?1:2,e):null},l.assetsArray=function(e){return e.map(l.asset)},l.buffer=function(e){return e.value?"base64"===e.type?u.from(e.value,"base64").toString("hex"):u.from(e.value).toString("hex"):""},l.date=function(e){return Number(new Date(e))/1e3},l.memo=function(e){return"text"===e.type?(e.type=1,e.text=e.value):"base64"===e.type||("id"===e.type?(e.type=2,e.id=e.value):"hash"===e.type?(e.type=3,e.hash=e.value):"return"===e.type&&(e.type=4,e.hash=e.value)),delete e.value,e},l.price=function(e){return"object"!==r(e)?{n:Number(e),d:1}:e},l.sequence=function(e){return Number(e)},l.signer=function(e){return e.key=e.value,"key"===e.type?e.type=0:"hash"===e.type?e.type=1:"tx"===e.type&&(e.type=2),e},e.exports=p},197:function(e,n,t){"use strict";var r=t(32),o=t(198),a=o.CosmicLink,i=o.specs,c={field:function(e,n,t){var r=i.fieldType[n];return e[r]?e[r](t):t},odesc:function(e,n){var t={};for(var r in n)t[r]=c.field(e,r,n[r]);return t}};e.exports=function e(n,t){var o=this;r(this,e);var s=new a(t).tdesc;i.transactionOptionalFields.forEach((function(e){var t=s[e];t&&(o[e]=c.field(n,e,t))})),this.operations=s.operations.map((function(e){return c.odesc(n,e)}))}},21:function(e,n,t){var r,o,a=t(22),i=t(23),c=n,s=t(167).default,u=t(47),p=t(196);function l(e,n,t){var r="m/44'/148'/".concat(e,"'");return(n||t)&&(r+=t?"/1'":"/0'"),n&&(r+="/".concat(n,"'")),r}function f(){return y.apply(this,arguments)}function y(){return(y=i(a.mark((function e(){var n;return a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return console.log("Attempting Trezor connection..."),r=s.stellarGetAddress({path:c.path}),e.next=4,r;case 4:if(!(n=e.sent).success){e.next=10;break}c.publicKey=n.payload.address,h(),e.next=11;break;case 10:throw new Error(n.payload.error);case 11:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function d(){r=null;["path","account","index","internalFlag","publicKey"].forEach((function(e){delete c[e]}))}function h(){console.log("Trezor connected"),"function"==typeof c.onConnect&&c.onConnect()}function m(){console.log("Trezor disconnected"),d(),"function"==typeof c.onDisconnect&&c.onDisconnect()}c.register=function(e,n){s.manifest({email:n,appUrl:e})},c.connect=function(){var e=i(a.mark((function e(n,t,i){var s;return a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(0!==n){e.next=2;break}throw new Error("Account number starts at 1.");case 2:if(void 0===n&&(n=c.account-1||0,t=c.index||0,i=c.internalFlag||!1),s=l(n,t,i),!o){e.next=8;break}return e.next=7,o;case 7:o=null;case 8:return c.path!==s&&(d(),c.account=n||0,c.path=s,c.index=t||0,c.internalFlag=i||!1),r||(r=f()),e.abrupt("return",r);case 11:case"end":return e.stop()}}),e)})));return function(n,t,r){return e.apply(this,arguments)}}(),c.sign=function(){var e=i(a.mark((function e(n){var r,o,i,l,f,y;return a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=t(26),c.publicKey){e.next=3;break}throw new Error("No Trezor connected.");case 3:return e.next=5,s.stellarSignTransaction({path:c.path,networkPassphrase:n.networkPassphrase,transaction:new p(n)});case 5:if((o=e.sent).success){e.next=8;break}throw new Error(o.payload.error);case 8:i=r.Keypair.fromPublicKey(c.publicKey),l=i.signatureHint(),f=u.from(o.payload.signature,"hex"),y=new r.xdr.DecoratedSignature({hint:l,signature:f}),n.signatures.push(y),console.log("signed",n);case 14:case"end":return e.stop()}}),e)})));return function(n){return e.apply(this,arguments)}}(),c.disconnect=i(a.mark((function e(){return a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:m();case 1:case"end":return e.stop()}}),e)}))),s.on("DEVICE_EVENT",(function(e){console.log("DEVICE_EVENT",console.log(e)),"device-disconnect"===e.type?m():"device-connect"===e.type&&h()})),c.onConnect=null,c.onDisconnect=null}}]);
//# sourceMappingURL=trezor.js.map